"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t=require("react"),n=(e=t)&&"object"==typeof e&&"default"in e?e.default:e;function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _objectWithoutProperties(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function _slicedToArray(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,o=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(i)throw o}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var buildScriptContent=function(e){var t=function(e){return"\n  window.dataLayer = window.dataLayer || [];\n  function gtag(){dataLayer.push(arguments);}\n  gtag('js', new Date());\n  gtag('config', '".concat(e.gaCode,"', ").concat(JSON.stringify(e.config),");\n")}(e);return e.extraGaCodes?e.extraGaCodes.reduce((function(e,t){return e+"gtag('config', '".concat(t,"');\n")}),t):t},buildOnloadEvent=function(e,t,n){return function(){!function(e,t){var n=document.createElement("script");n.innerHTML=buildScriptContent(e),t.appendChild(n)}(e,t);var r=e.setSingleton();window.ga&&Object.assign(r,{ga:e.ga}),n(r)}},addScriptEvents=function(e,t,n,r,i){t.onload=buildOnloadEvent(e,n,r),t.onerror=function(e){return function(){e(new Error("Google Analytics failed to initialize!"))}}(i)},buildScriptTags=function(e,t,n){var r=document.getElementsByTagName("head")[0],i=function(e){var t=document.createElement("script");return t.setAttribute("async",""),t.setAttribute("src","https://www.googletagmanager.com/gtag/js?id=".concat(e)),t}(e.gaCode);addScriptEvents(e,i,r,t,n),function(e,t){document.onreadystatechange=function(){"interactive"===document.readyState&&t.appendChild(e)}}(i,r)},r=Object.freeze({PAGE_VIEW:Object.freeze({page_location:"location",page_title:"title"}),UA_EVENT_PROPS:Object.freeze({value:"value",action:"action",label:"event_label",category:"event_category",nonInteraction:"non_interaction"})}),mapEventKeys=function(e,t){var n=function(e){return"string"==typeof e?r[e]:e}(t);return Object.entries(n).reduce((function(t,n){var r=_slicedToArray(n,2),i=r[0],o=r[1];return"value"===i&&e[i]<0||e[i]&&(t[o]=e[i]),t}),{})},noOpOverride=function(e){return function(){console.error("Method ".concat(e," should be overwritten with GAController instance method!"))}},i={initialized:!1,gtag:noOpOverride("GAController#gtag"),uaEvent:noOpOverride("GAController#uaEvent"),pageView:noOpOverride("GAController#pageView"),event:noOpOverride("GAController#event")},o=function GAController(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,GAController),this.setSingleton=function(){return Object.assign(i,{initialized:!0,pageView:t.pageView,uaEvent:t.uaEvent,event:t.event,gtag:t.gtag}),i},this.initialize=function(){return new Promise((function(e,n){GAController.isInitialized()?n(new Error("Google Analytics has already been initialized!")):buildScriptTags(t,e,n)}))},this.pageView=function(e){var n=e.location,r=void 0===n?window.location:n,i=e.title,o=void 0===i?document.title:i,a=mapEventKeys({location:r,title:o},"PAGE_VIEW");return t.gtag("event","page_view",a)},this.uaEvent=function(e){var n=e.action,r=_objectWithoutProperties(e,["action"]),i=mapEventKeys(r,"UA_EVENT_PROPS");return t.gtag("event",n,i)},this.event=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.gtag("event",e,n)},this.ga=function(){var e;return(e=window).ga.apply(e,arguments)},this.gtag=function(){var e;return(e=window).gtag.apply(e,arguments)};var r=n.gaCodes,o=_objectWithoutProperties(n,["gaCodes"]);this.config=o,this.gaCode=e,this.extraGaCodes=r||[],this.initialized=!1};o.isInitialized=function(){return i.initialized},o.getInstance=function(e){return o.isInitialized()?i:e&&console.warn("Google Analytics is not initialized")};var injectChildren=function(e,n,r){return n&&e&&"function"==typeof r&&r(function(e,n){return t.Children.map(e,(function(e,r){return t.isValidElement(e)?(i=e)&&i.type&&void 0!==i.type.name?t.cloneElement(e,{rga4:n,index:r}):e:t.createElement(t.Fragment,null,e);var i}))}(e,n))},useRGA4=function(e,n){var r=_slicedToArray(t.useState(o.getInstance()),2),i=r[0],a=r[1];return t.useEffect((function(){o.isInitialized()?function(e,t,n){var r=e.children,i=o.getInstance();injectChildren(r,i,t),n(i)}(e,n,a):function(e,t,n){var r=e.code,i=e.config,a=e.gaCodes,c=e.children;new o("".concat(r),i,a).initialize().then((function(e){injectChildren(c,e,t),n(e)})).catch((function(e){console.error(e.stack)}))}(e,n,a)}),[]),[i,a]},RGA4=function(e){var r=_slicedToArray(t.useState(null),2),i=r[0],o=r[1];return useRGA4(e,o),n.createElement(n.Fragment,null,i)},usePageView=function(e){return t.useEffect((function(){o.isInitialized()?function(e){var t=o.getInstance();t&&t.pageView(e)}(e):function(e){var t=e.gaCode,n=_objectWithoutProperties(e,["gaCode"]);new o(t).initialize().then((function(e){e.pageView(n)})).catch((function(e){console.error(e)}))}(e)}))};exports.RGA4=RGA4,exports.RGA4Injector=function(e){var r=e.code,i=e.children,o=_objectWithoutProperties(e,["code","children"]);return n.createElement(RGA4,{code:r},function(e,r){return t.isValidElement(e)?n.createElement(e,r):"function"==typeof e?e(r):t.createElement(t.Fragment,null,e)}(i,o))},exports.usePageView=usePageView,exports.useRGA4=useRGA4,exports.withPageView=function(e){var PageViewHoc=function(t){var r=t.location,i=t.title,o=t.gaCode;return usePageView({location:r,title:i,gaCode:o}),n.createElement(e,t)},t=e.displayName||e.name||"Component";return PageViewHoc.displayName="WithPageView(".concat(t,")"),PageViewHoc};
//# sourceMappingURL=rga4.js.map
