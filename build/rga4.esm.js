import t,{Children as n,isValidElement as e,createElement as r,Fragment as i,cloneElement as o,useState as a,useEffect as c}from"react";function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function _objectWithoutProperties(t,n){if(null==t)return{};var e,r,i=function(t,n){if(null==t)return{};var e,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)e=o[r],n.indexOf(e)>=0||(i[e]=t[e]);return i}(t,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)e=o[r],n.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(t,e)&&(i[e]=t[e])}return i}function _slicedToArray(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var e=[],r=!0,i=!1,o=void 0;try{for(var a,c=t[Symbol.iterator]();!(r=(a=c.next()).done)&&(e.push(a.value),!n||e.length!==n);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==c.return||c.return()}finally{if(i)throw o}}return e}(t,n)||function(t,n){if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return _arrayLikeToArray(t,n)}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}var buildScriptContent=function(t){var n=function(t){return"\n  window.dataLayer = window.dataLayer || [];\n  function gtag(){dataLayer.push(arguments);}\n  gtag('js', new Date());\n  gtag('config', '".concat(t.gaCode,"', ").concat(JSON.stringify(t.config),");\n")}(t);return t.extraGaCodes?t.extraGaCodes.reduce((function(t,n){return t+"gtag('config', '".concat(n,"');\n")}),n):n},buildOnloadEvent=function(t,n,e){return function(){!function(t,n){var e=document.createElement("script");e.innerHTML=buildScriptContent(t),n.appendChild(e)}(t,n);var r=t.setSingleton();window.ga&&Object.assign(r,{ga:t.ga}),e(r)}},addScriptEvents=function(t,n,e,r,i){n.onload=buildOnloadEvent(t,e,r),n.onerror=function(t){return function(){t(new Error("Google Analytics failed to initialize!"))}}(i)},buildScriptTags=function(t,n,e){var r=document.getElementsByTagName("head")[0],i=function(t){var n=document.createElement("script");return n.setAttribute("async",""),n.setAttribute("src","https://www.googletagmanager.com/gtag/js?id=".concat(t)),n}(t.gaCode);addScriptEvents(t,i,r,n,e),function(t,n){document.onreadystatechange=function(){"interactive"===document.readyState&&n.appendChild(t)}}(i,r)},u=Object.freeze({PAGE_VIEW:Object.freeze({page_location:"location",page_title:"title"}),UA_EVENT_PROPS:Object.freeze({value:"value",action:"action",label:"event_label",category:"event_category",nonInteraction:"non_interaction"})}),mapEventKeys=function(t,n){var e=function(t){return"string"==typeof t?u[t]:t}(n);return Object.entries(e).reduce((function(n,e){var r=_slicedToArray(e,2),i=r[0],o=r[1];return"value"===i&&t[i]<0||t[i]&&(n[o]=t[i]),n}),{})},noOpOverride=function(t){return function(){console.error("Method ".concat(t," should be overwritten with GAController instance method!"))}},l={initialized:!1,gtag:noOpOverride("GAController#gtag"),uaEvent:noOpOverride("GAController#uaEvent"),pageView:noOpOverride("GAController#pageView"),event:noOpOverride("GAController#event")},f=function GAController(t){var n=this,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,GAController),this.setSingleton=function(){return Object.assign(l,{initialized:!0,pageView:n.pageView,uaEvent:n.uaEvent,event:n.event,gtag:n.gtag}),l},this.initialize=function(){return new Promise((function(t,e){GAController.isInitialized()?e(new Error("Google Analytics has already been initialized!")):buildScriptTags(n,t,e)}))},this.pageView=function(t){var e=t.location,r=void 0===e?window.location:e,i=t.title,o=void 0===i?document.title:i,a=mapEventKeys({location:r,title:o},"PAGE_VIEW");return n.gtag("event","page_view",a)},this.uaEvent=function(t){var e=t.action,r=_objectWithoutProperties(t,["action"]),i=mapEventKeys(r,"UA_EVENT_PROPS");return n.gtag("event",e,i)},this.event=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n.gtag("event",t,e)},this.ga=function(){var t;return(t=window).ga.apply(t,arguments)},this.gtag=function(){var t;return(t=window).gtag.apply(t,arguments)};var r=e.gaCodes,i=_objectWithoutProperties(e,["gaCodes"]);this.config=i,this.gaCode=t,this.extraGaCodes=r||[],this.initialized=!1};f.isInitialized=function(){return l.initialized},f.getInstance=function(t){return f.isInitialized()?l:t&&console.warn("Google Analytics is not initialized")};var injectChildren=function(t,a,c){return a&&t&&"function"==typeof c&&c(function(t,a){return n.map(t,(function(t,n){return e(t)?(c=t)&&c.type&&void 0!==c.type.name?o(t,{rga4:a,index:n}):t:r(i,null,t);var c}))}(t,a))},useRGA4=function(t,n){var e=_slicedToArray(a(f.getInstance()),2),r=e[0],i=e[1];return c((function(){f.isInitialized()?function(t,n,e){var r=t.children,i=f.getInstance();injectChildren(r,i,n),e(i)}(t,n,i):function(t,n,e){var r=t.code,i=t.config,o=t.gaCodes,a=t.children;new f("".concat(r),i,o).initialize().then((function(t){injectChildren(a,t,n),e(t)})).catch((function(t){console.error(t.stack)}))}(t,n,i)}),[]),[r,i]},RGA4=function(n){var e=_slicedToArray(a(null),2),r=e[0],i=e[1];return useRGA4(n,i),t.createElement(t.Fragment,null,r)},RGA4Injector=function(n){var o=n.code,a=n.children,c=_objectWithoutProperties(n,["code","children"]);return t.createElement(RGA4,{code:o},function(n,o){return e(n)?t.createElement(n,o):"function"==typeof n?n(o):r(i,null,n)}(a,c))},usePageView=function(t){return c((function(){f.isInitialized()?function(t){var n=f.getInstance();n&&n.pageView(t)}(t):function(t){var n=t.gaCode,e=_objectWithoutProperties(t,["gaCode"]);new f(n).initialize().then((function(t){t.pageView(e)})).catch((function(t){console.error(t)}))}(t)}))},withPageView=function(n){var PageViewHoc=function(e){var r=e.location,i=e.title,o=e.gaCode;return usePageView({location:r,title:i,gaCode:o}),t.createElement(n,e)},e=n.displayName||n.name||"Component";return PageViewHoc.displayName="WithPageView(".concat(e,")"),PageViewHoc};export{RGA4,RGA4Injector,usePageView,useRGA4,withPageView};
//# sourceMappingURL=rga4.esm.js.map
