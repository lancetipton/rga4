{"version":3,"file":"rga4.esm.js","sources":["../src/helpers/buildContentScript.js","../src/ga4/GAController.js"],"sourcesContent":["/**\n * @import {GAController} from './typeDefs'\n */\n\n/**\n * Generates the code needed to initialize google analytics 4\n * <br/> Taken from https://developers.google.com/analytics/devguides/collection/ga4\n * @function\n * @private\n * @param {GAController} GA4Instance - Instance of the GAController class\n *\n * @returns {string} - Inner HTML content for the GTag Script Dom element\n */\nconst getScriptContent = GA4Instance => `\n  window.dataLayer = window.dataLayer || [];\n  function gtag(){dataLayer.push(arguments);}\n  gtag('js', new Date());\n  gtag('config', '${GA4Instance.gaCode}', ${JSON.stringify(\n  GA4Instance.config\n)});\n`\n\n/**\n * Builds the code to be used as the Inner HTML content for the GTag Script Dom element\n * @function\n * @private\n * @param {GAController} GA4Instance - Instance of the GAController class\n *\n * @returns {string} - Inner HTML content for the GTag Script Dom element\n */\nconst buildScriptContent = GA4Instance => {\n  const content = getScriptContent(GA4Instance)\n\n  return !GA4Instance.extraGaCodes\n    ? content\n    : GA4Instance.extraGaCodes.reduce(\n        (content, code) => content + `gtag('config', '${code}');\\n`,\n        content\n      )\n}\n\n/**\n * Builds a script dom node that initializes gtag\n * <br/> Initialization code taken from https://developers.google.com/analytics/devguides/collection/ga4\n * @function\n * @export\n * @private\n * @param {GAController} GA4Instance - Instance of the GAController class\n * @param {Object} head - Current documents Head Dom element\n *\n * @returns {Object} - GTag Script Dom element\n */\nexport const buildContentScript = (GA4Instance, head) => {\n  const script = document.createElement('script')\n  script.innerHTML = buildScriptContent(GA4Instance)\n  head.appendChild(script)\n\n  return script\n}\n","/**\n * @import {GA4Singleton, PageViewEvent, UAEvent} from '../typeDefs'\n */\n\nimport { buildScriptTags } from '../helpers/buildScriptTags'\nimport { mapEventKeys } from '../helpers/mapEventKeys'\nimport { GA4Singleton } from './GA4Singleton'\n\n/**\n * @class GAController\n * @desc Class required to manage google analytics 4\n * @export\n * @param {string} gaCode - Google Analytic 4 Measurement ID\n * @param {string} [options={}] - Custom analytic config options\n * @param {string} options.gaCodes - Additional Measurement IDs\n *\n * @returns {GAController} GAController instance\n */\nexport class GAController {\n  constructor(gaCode, options = {}) {\n    const { gaCodes, ...config } = options\n    this.config = config\n    this.gaCode = gaCode\n    this.extraGaCodes = gaCodes || []\n    this.initialized = false\n  }\n\n  /**\n   * Sets the singleton to initialized, and adds methods\n   * @memberof GAController\n   * @instance\n   * @function\n   *\n   * @returns {Object} GA4Singleton\n   */\n  setSingleton = () => {\n    Object.assign(GA4Singleton, {\n      initialized: true,\n      pageView: this.pageView,\n      uaEvent: this.uaEvent,\n      event: this.event,\n      gtag: this.gtag,\n    })\n\n    return GA4Singleton\n  }\n\n  /**\n   * Builds the google analytics scripts tags\n   * Then initializes and returns the GA4Singleton object\n   * @memberof GAController\n   * @instance\n   * @function\n   *\n   * @returns {Class} GAController instance\n   */\n  initialize = () => {\n    return new Promise((resolve, reject) => {\n      GAController.isInitialized()\n        ? reject(new Error('Google Analytics has already been initialized!'))\n        : buildScriptTags(this, resolve, reject)\n    })\n  }\n\n  /**\n   * Shortcut helper so send a page view event\n   * @function\n   * @memberof GAController\n   * @instance\n   * @param {PageViewEvent} event\n   *\n   * @returns {*} Response from the global gtag method\n   */\n  pageView = ({ location = window.location, title = document.title }) => {\n    const event = mapEventKeys({ location, title }, 'PAGE_VIEW')\n\n    return this.gtag('event', 'page_view', event)\n  }\n\n  /**\n   * Build a predefined event and send to gtag\n   * @function\n   * @memberof GAController\n   * @instance\n   * @param {UAEvent} event\n   *\n   * @returns {*} Response from the global gtag method\n   */\n  uaEvent = event => {\n    const { action, ...eventData } = event\n    const uaEvent = mapEventKeys(eventData, 'UA_EVENT_PROPS')\n\n    return this.gtag('event', action, uaEvent)\n  }\n\n  /**\n   * Build event and send to gtag\n   * @function\n   * @memberof GAController\n   * @instance\n   * @param {string} name - What the event should be called\n   * @param {Object} props - Key/values pairs of properties of the event\n   *\n   * @returns {*} Response from the global gtag method\n   */\n  event = (name, props = {}) => {\n    return this.gtag('event', name, props)\n  }\n\n  /**\n   * Direct access to ga\n   * @function\n   * @memberof GAController\n   * @instance\n   * @param {Object} args - Arguments for the global ga method\n   *\n   * @returns {*} Response from the global ga method\n   */\n  ga = (...args) => window.ga(...args)\n\n  /**\n   * Direct access to gtag\n   * @function\n   * @memberof GAController\n   * @instance\n   * @param {Object} args - Arguments for the global gtag method\n   *\n   * @returns {*} Response from the global gtag method\n   */\n  gtag = (...args) => window.gtag(...args)\n}\n\n/**\n * Check if google analytics is initialized\n * @function\n * @memberof GAController\n * @static\n *\n * @returns {boolean} - True if google analytics is initialized\n */\nGAController.isInitialized = () => {\n  return GA4Singleton.initialized\n}\n\n/**\n * Get RGA4 singleton instance if it's initialized\n * @function\n * @memberof GAController\n * @static\n * @param {boolean} showWarn - Show warning when singleton is not initialized\n * @returns {Object} - GA4Singleton\n */\nGAController.getInstance = showWarn => {\n  return GAController.isInitialized()\n    ? GA4Singleton\n    : showWarn && console.warn('Google Analytics is not initialized')\n}\n"],"names":["GAController"],"mappings":"moDAaA,qkGC+HAA,iDAYAA"}